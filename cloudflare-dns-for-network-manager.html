<!DOCTYPE html><html lang="en"><head><title>hella labs - CloudFlare DNS for Network Manager</title><meta charset="utf-8"><meta name="generator" content="Pelican"><link href="https://www.qrk.us/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="hella labs Full Atom Feed"><link href="https://www.qrk.us/feeds/tech.atom.xml" type="application/atom+xml" rel="alternate" title="hella labs Categories Atom Feed"><meta name="tags" content="Linux"><meta name="tags" content="dns"><meta name="tags" content="sysadmin"><meta name="tags" content="network manager"></head><body id="index" class="home"><header id="banner" class="body"><h1><a href="./">hella labs</a></h1></header><nav id="menu"><ul><li><a href="./pages/about.html">About</a></li><li><a href="./pages/projects.html">Projects</a></li><li class="active"><a href="./category/tech.html">Tech</a></li></ul></nav><section id="content" class="body"><header><h2 class="entry-title"><a href="./cloudflare-dns-for-network-manager.html" rel="bookmark" title="Permalink to CloudFlare DNS for Network Manager">CloudFlare DNS for Network Manager</a></h2></header><footer class="post-info"><time class="published" datetime="2023-09-23T23:07:59.218684-04:00"> Sat 23 September 2023 </time><time class="modified" datetime="2023-09-23T23:07:59.218684-04:00"> Sat 23 September 2023 </time><address class="vcard author"> By <a class="url fn" href="./author/ken.html">Ken</a></address><div class="category"> Category: <a href="./category/tech.html">Tech</a></div><div class="tags"> Tags: <a href="./tag/linux.html">Linux</a><a href="./tag/dns.html">dns</a><a href="./tag/sysadmin.html">sysadmin</a><a href="./tag/network-manager.html">network manager</a></div></footer><div class="entry-content"><p>CloudFlare provides <a href="https://developers.cloudflare.com/1.1.1.1/what-is-1.1.1.1/">a performant recursive nameserver</a> along with a promise to never surveil their users.</p><p>Their Linux quickstart involves modifying the standard C library's resolver (i.e. /etc/resolv.conf) which is a terrible idea if you are using most of the popular flavors of Linux as a daily driver desktop OS because they're likely using <code>dnsmasq</code> or <code>resolvconf</code> or both to declare the contents of that file.</p><p>For what it's worth, here's shellcode to quickly reconfigure an existing Network Manager saved connection with <code>nmcli</code>.</p><div class="highlight"><pre><span></span><code><span class="c1"># make a note of the name of the connection you wish to configure e.g. &quot;WiFi Secure&quot;</span>
nmcli<span class="w"> </span>connection<span class="w"> </span>show

<span class="c1"># save the name of the connection in a variable</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">CONN</span><span class="o">=</span><span class="s2">&quot;WiFi Secure&quot;</span>

<span class="c1"># paste the following in your terminal to reconfigure DNS</span>
nmcli<span class="w"> </span>connection<span class="w"> </span>modify<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$CONN</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>ipv4.ignore-auto-dns<span class="w"> </span>yes<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>ipv4.never-default<span class="w"> </span>no<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>ipv4.dns<span class="w"> </span><span class="s2">&quot;1.1.1.1&quot;</span>

<span class="c1"># reactivate the saved connection</span>
nmcli<span class="w"> </span>connection<span class="w"> </span>up<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$CONN</span><span class="s2">&quot;</span>

<span class="c1"># optionally restore default DNS (DHCP)</span>
nmcli<span class="w"> </span>connection<span class="w"> </span>modify<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$CONN</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>ipv4.ignore-auto-dns<span class="w"> </span>no
</code></pre></div></div></section><footer id="contentinfo" class="body"><address id="about" class="vcard body"> Proudly powered by <a href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a href="https://www.python.org/">Python</a>. </address></footer></body></html>