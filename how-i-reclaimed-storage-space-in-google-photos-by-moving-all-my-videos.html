<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><title>How I Reclaimed Storage Space in Google Photos By Moving All My Videos</title><link rel="stylesheet" href="././css/main.css"><link href="https://www.qrk.us/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="hella labs Atom Feed"></head><body id="index" class="home"><header id="banner" class="body"><h1><a href="./">hella labs </a></h1><nav><ul><li><a href="./pages/about.html">About</a></li><li><a href="./pages/projects.html">Projects</a></li><li class="active"><a href="./category/tech.html">Tech</a></li></ul></nav></header><section id="content" class="body"><article><header><h1 class="entry-title"><a href="./how-i-reclaimed-storage-space-in-google-photos-by-moving-all-my-videos.html" rel="bookmark" title="Permalink to How I Reclaimed Storage Space in Google Photos By Moving All My Videos">How I Reclaimed Storage Space in Google Photos By Moving All My Videos</a></h1></header><div class="entry-content"><footer class="post-info"><abbr class="published" title="2023-09-24T15:36:04.979187-04:00"> Published: Sun 24 September 2023 </abbr><br><abbr class="modified" title="2023-09-24T15:36:04.979187-04:00"> Updated: Sun 24 September 2023 </abbr><address class="vcard author"> By <a class="url fn" href="./author/ken.html">Ken</a></address><p>tags: <a href="./tag/python.html">python</a> <a href="./tag/backup.html">backup</a> <a href="./tag/rclone.html">rclone</a> <a href="./tag/googlephototos.html">googlephototos</a> <a href="./tag/googleapis.html">googleapis</a> </p></footer> <p>There's no easy way to find and delete a particular file or type of file in Google Photos, and there's no way to bulk delete with a tool or even the API. Here's a simple tool chain that answered my need to move all videos out to reclaim storage space.</p><div class="toc"><span class="toctitle">Table of contents:</span><ul><li><a href="#sync-photos-and-videos">Sync Photos and Videos</a></li><li><a href="#move-videos">Move Videos</a></li><li><a href="#delete-all-videos-from-google-photos">Delete All Videos From Google Photos</a></li><li><a href="#replicated-videos-to-new-storage">Replicated Videos to New Storage</a></li></ul></div><p>Google Photos has some unique talents. I find it useful for exploring my own archives with the built-in machine learning features like "pictures from Ashland" or "red car". The balance of value is less favorable for videos, and they were the only reason I was paying for 2TB of cloud storage, so I decided to prune them out of my Google Photos account.</p><p>Problem: there's no easy way to do that! Even the API doesn't have a delete operation. I can find them easily enough in the app by searching "videos", and I can painstakingly download them and delete them, but I'd prefer to express this as code, if possible.</p><h2 id="sync-photos-and-videos">Sync Photos and Videos</h2><p>I found <code>gphotos-sync</code>, a handy implementation of the Google Photos API that creates a local replica of the entire library with albums and other metadata that I didn't need. Still, supremely useful to make sure I have a copy of all videos.</p><h2 id="move-videos">Move Videos</h2><p>I wrote a tiny Python program to to move my videos out of the gphotos-sync directory.</p><ol><li>walk the gphotos-sync photos directory</li><li>detect if a file is a video MIME type</li><li>move the videos to a new folder</li></ol><div class="highlight"><pre><span></span><code>‚ùØ<span class="w"> </span>python<span class="w"> </span>./move_videos.py
Moving:<span class="w"> </span>./2017/02/2017-02-15-they-sang.mp4<span class="w"> </span><span class="m">787</span>.8MiB<span class="w"> </span>-&gt;<span class="w"> </span>./Videos/videos_from_gphotos/2017/02/2017-02-15-they-sang.mp4
Moving:<span class="w"> </span>./2003/04/or-portland-roofing_residence.3gp<span class="w"> </span><span class="m">849</span>.1KiB<span class="w"> </span>-&gt;<span class="w"> </span>./Videos/videos_from_gphotos/2003/04/or-portland-roofing_residence.3gp
Moving:<span class="w"> </span>./2003/02/or-ashland-alex_and_ax_blowin_in_the_wind.3gp<span class="w"> </span><span class="m">1</span>.0MiB<span class="w"> </span>-&gt;<span class="w"> </span>./Videos/videos_from_gphotos/1973/02/or-ashland-alex_and_ax_blowin_in_the_wind.3gp
Total:<span class="w"> </span><span class="m">58</span>.7GiB
</code></pre></div><div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">filetype</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">join</span><span class="p">,</span> <span class="n">getsize</span><span class="p">,</span> <span class="n">dirname</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">walk</span><span class="p">,</span> <span class="n">chdir</span>
<span class="kn">from</span> <span class="nn">shutil</span> <span class="kn">import</span> <span class="n">move</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="c1"># move_videos.py moves files with a video MIME type to a different top-level directory with the same directory structure</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="c1"># The top argument for walk</span>
    <span class="n">topdir</span> <span class="o">=</span> <span class="s1">&#39;./Downloads/from_gphotos/photos&#39;</span>
    <span class="n">dest_topdir</span> <span class="o">=</span> <span class="s1">&#39;./Videos/videos_from_gphotos&#39;</span>
    <span class="n">chdir</span><span class="p">(</span><span class="n">topdir</span><span class="p">)</span>

    <span class="n">total_bytes</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">walk</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span><span class="o">.</span><span class="n">is_symlink</span><span class="p">():</span>
                <span class="k">continue</span>
            <span class="k">elif</span> <span class="n">filetype</span><span class="o">.</span><span class="n">is_video</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">name</span><span class="p">)):</span>
                <span class="n">size</span> <span class="o">=</span> <span class="n">getsize</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
                <span class="n">total_bytes</span> <span class="o">=</span> <span class="n">size</span><span class="o">+</span><span class="n">total_bytes</span>
                <span class="n">dest</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">dest_topdir</span><span class="p">,</span> <span class="n">root</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;./&#39;</span><span class="p">),</span> <span class="n">name</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Moving:&quot;</span><span class="p">,</span> <span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">name</span><span class="p">),</span> <span class="n">sizeof_fmt</span><span class="p">(</span><span class="n">size</span><span class="p">),</span> <span class="s2">&quot;-&gt;&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">parent</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">dirname</span><span class="p">(</span><span class="n">dest</span><span class="p">))</span>
                    <span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">move</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">name</span><span class="p">),</span> <span class="n">dest</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="k">raise</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Total:&quot;</span><span class="p">,</span> <span class="n">sizeof_fmt</span><span class="p">(</span><span class="n">total_bytes</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">sizeof_fmt</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;B&quot;</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">unit</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;Ki&quot;</span><span class="p">,</span> <span class="s2">&quot;Mi&quot;</span><span class="p">,</span> <span class="s2">&quot;Gi&quot;</span><span class="p">,</span> <span class="s2">&quot;Ti&quot;</span><span class="p">,</span> <span class="s2">&quot;Pi&quot;</span><span class="p">,</span> <span class="s2">&quot;Ei&quot;</span><span class="p">,</span> <span class="s2">&quot;Zi&quot;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1024.0</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">num</span><span class="si">:</span><span class="s2">3.1f</span><span class="si">}{</span><span class="n">unit</span><span class="si">}{</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">num</span> <span class="o">/=</span> <span class="mf">1024.0</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">num</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">Yi</span><span class="si">{</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</code></pre></div><h2 id="delete-all-videos-from-google-photos">Delete All Videos From Google Photos</h2><p>There's a simple trick to do this in a fell swoop.</p><ol><li>search "videos" and make sure the results are all videos</li><li>tick the select box on the first result</li><li>scroll down to the bottom of results</li><li>hold SHIFT and left-click the last result</li><li>click the trash button or press <code>#</code> to delete</li></ol><p>As of this writing the videos would be in Trash for 60 days before they're permanently deleted and the available storage returned to you.</p><h2 id="replicated-videos-to-new-storage">Replicated Videos to New Storage</h2><p>I still need to keep a copy of my videos off-site in case something happens to my storage at home or I lose access for some reason. I didn't want to keep track of copying the files so it needs to be an automated sync.</p><p>I chose <code>rclone</code> which is a versatile sync tool for cloud storage. It works with S3-compliant APIs, and I found STORJ has a very cheap option and as a bonus it is a form decentralized storage with an open-source bent. Cool.</p><ol><li>I signed up for Storj's free 150GB option and added about 20 USD worth of STORJ tokens to my account to cover future overages. No credit card required. </li><li>I followed <a href="https://docs.storj.io/dcs/how-tos/sync-files-with-rclone/rclone-with-native-integration/">Storj's own guide</a> for configuring <code>rclone</code>.</li><li>I added a sync command to my backup script:</li></ol><div class="highlight"><pre><span></span><code>rclone<span class="w"> </span>sync<span class="w"> </span>~/Videos/<span class="w"> </span>storj:videos/
</code></pre></div></div></article></section><section id="extras" class="body"><div class="social"><h2>social</h2><ul><li><a href="https://www.qrk.us/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li></ul></div></section></body></html>